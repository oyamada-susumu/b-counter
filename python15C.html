<!DOCTYPE html>
<html>
<head><title>15C ASEMBLA</title></head>
<body>
    <table id="memTbl" border="1">
        <tr> <td>0</td> <td>c1</td> <td>c2</td> <td>c3</td> </tr>
        <tr> <td>1</td> <td>c1</td> <td>c2</td> <td>c3</td> </tr>
        <tr> <td>2</td> <td>c1</td> <td>c2</td> <td>c3</td> </tr>
        <tr> <td>3</td> <td>c1</td> <td>c2</td> <td>c3</td> </tr>
        <tr> <td>4</td> <td>c1</td> <td>c2</td> <td>c3</td> </tr>
        <tr> <td>5</td> <td>c1</td> <td>c2</td> <td>c3</td> </tr>
        <tr> <td>6</td> <td>c1</td> <td>c2</td> <td>c3</td> </tr>
        <tr> <td>7</td> <td>c1</td> <td>c2</td> <td>c3</td> </tr>
        <tr> <td>8</td> <td>c1</td> <td>c2</td> <td>c3</td> </tr>
        <tr> <td>9</td> <td>c1</td> <td>c2</td> <td>c3</td> </tr>
        <tr> <td>11</td> <td>c1</td> <td>c2</td> <td>c3</td> </tr>
        <tr> <td>12</td> <td>c1</td> <td>c2</td> <td>c3</td> </tr>
        <tr> <td>13</td> <td>c1</td> <td>c2</td> <td>c3</td> </tr>
        <tr> <td>14</td> <td>c1</td> <td>c2</td> <td>c3</td> </tr>
        <tr> <td>15</td> <td>c1</td> <td>c2</td> <td>c3</td> </tr>
        <tr> <td>16</td> <td>c1</td> <td>c2</td> <td>c3</td> </tr>
        <tr> <td>17</td> <td>c1</td> <td>c2</td> <td>c3</td> </tr>
        <tr> <td>18</td> <td>c1</td> <td>c2</td> <td>c3</td> </tr>
        <tr> <td>19</td> <td>c1</td> <td>c2</td> <td>c3</td> </tr>
        <tr> <td>20</td> <td>c1</td> <td>c2</td> <td>c3</td> </tr>
        <tr> <td>21</td> <td>c1</td> <td>c2</td> <td>c3</td> </tr>
        <tr> <td>22</td> <td>c1</td> <td>c2</td> <td>c3</td> </tr>
        <tr> <td>23</td> <td>c1</td> <td>c2</td> <td>c3</td> </tr>
        <tr> <td>24</td> <td>c1</td> <td>c2</td> <td>c3</td> </tr>
        <tr> <td>25</td> <td>c1</td> <td>c2</td> <td>c3</td> </tr>
        <tr> <td>26</td> <td>c1</td> <td>c2</td> <td>c3</td> </tr>
        <tr> <td>27</td> <td>c1</td> <td>c2</td> <td>c3</td> </tr>
        <tr> <td>28</td> <td>c1</td> <td>c2</td> <td>c3</td> </tr>
        <tr> <td>29</td> <td>c1</td> <td>c2</td> <td>c3</td> </tr>
        <tr> <td>30</td> <td>c1</td> <td>c2</td> <td>c3</td> </tr>
        <tr> <td>31</td> <td>c1</td> <td>c2</td> <td>c3</td> </tr>
        <tr> <td>32</td> <td>c1</td> <td>c2</td> <td>c3</td> </tr>
        <tr> <td>33</td> <td>c1</td> <td>c2</td> <td>c3</td> </tr>
        <tr> <td>34</td> <td>c1</td> <td>c2</td> <td>c3</td> </tr>
        <tr> <td>35</td> <td>c1</td> <td>c2</td> <td>c3</td> </tr>
        <tr> <td>36</td> <td>c1</td> <td>c2</td> <td>c3</td> </tr>
        <tr> <td>37</td> <td>c1</td> <td>c2</td> <td>c3</td> </tr>
        <tr> <td>38</td> <td>c1</td> <td>c2</td> <td>c3</td> </tr>
        <tr> <td>39</td> <td>c1</td> <td>c2</td> <td>c3</td> </tr>
        <tr> <td>40</td> <td>c1</td> <td>c2</td> <td>c3</td> </tr>
        <tr> <td>41</td> <td>c1</td> <td>c2</td> <td>c3</td> </tr>
        <tr> <td>42</td> <td>c1</td> <td>c2</td> <td>c3</td> </tr>
        <tr> <td>43</td> <td>c1</td> <td>c2</td> <td>c3</td> </tr>
        <tr> <td>44</td> <td>c1</td> <td>c2</td> <td>c3</td> </tr>
        <tr> <td>45</td> <td>c1</td> <td>c2</td> <td>c3</td> </tr>
        <tr> <td>46</td> <td>c1</td> <td>c2</td> <td>c3</td> </tr>
        <tr> <td>47</td> <td>c1</td> <td>c2</td> <td>c3</td> </tr>
        <tr> <td>48</td> <td>c1</td> <td>c2</td> <td>c3</td> </tr>
        <tr> <td>49</td> <td>c1</td> <td>c2</td> <td>c3</td> </tr>
        <tr> <td>50</td> <td>c1</td> <td>c2</td> <td>c3</td> </tr>
    </table>    
<script>
window.onload = function(){
/* # Python15B (学習ノートP37も可) */
/* # 疑似言語の命令コードを定義する。*/
READ=1; WRITE=2; ADD=3; STOP=4; SUB=5; JNZ=8; DATA=9;
A=6; B=7;                 /* # Aレジスタ、Bレジスタ */
NUL = null;               /* # nullは予約語 空欄 何もしない 何もない ヌル */
n=["0=未定義","1=READ","2=WRITE","3=ADD","4=STOP","5=SUB","6=A","7=B","8=JNZ","9=DATA"];
/* # 主記憶(メモリ)この下にプログラムやデータを記入する。 */
m=[];
/* # [c0, c1, c2, c3] # */
m.push([0, NUL, NUL, NUL]);
m.push([1, READ, A, 12]);
m.push([2, READ, B, 11]);
m.push([3, ADD, A, 10]);
m.push([4, SUB, B, 13]);
m.push([5, JNZ, 3, NUL]);
m.push([6, WRITE, 12, A]);
m.push([7, STOP, NUL, NUL]);
m.push([8, NUL, NUL, NUL]);
m.push([9, NUL, NUL, NUL]);
m.push([10,DATA, 5, NUL]);      /* # 5×2=10 */
m.push([11,DATA, 2, NUL]);
m.push([12,DATA, 0, NUL]);      /* #計算結果が入る */
m.push([13,DATA, 1, NUL]);      /* #定数1 2-1=1,1-1=0 */
m.push([14,NUL, NUL, NUL]);
window.alert("*** PROGRAM START ***")
p=0;            /* #プログラムカウンタに0を代入する。*/
rega=0;regb=0;  /* #レジスタAに0，レジスタBに0を代入する。 */
regf=0;         /* #フラグレジスタに0を代入する。 演算結果が0のときに１，それ以外は0 */
/* regdump()      /* #プログラムカウンタの値とレジスタの値を表示する。 */
memdump(m);
while (m[p][1] != STOP) {      /* #STOPでない間以下を繰り返す。 */
/* #c0=行番号,c1=命令,c2=レジスタ名または番地,c3=レジスタ名または番地 */
    c0=m[p][0]; c1=m[p][1]; c2=m[p][2]; c3=m[p][3]
    if (c1 == NUL) {           /* #もしNUL命令ならば */
        ;                      /* #なにもしない。 */
        }
/* 実行命令 */               
    if (c1 == READ) {               /* #もしREAD命令ならば */
        if (c2 == A) {              /* #もしレジスタAならば */
            rega = m[c3][2];        /* #指定番地の値をレジスタAに読み込む。 */
        } else if (c2 == B) {       /* #もしレジスタBならば */
            regb = m[c3][2];        /* #指定番地の値をレジスタBに読み込む。 */
        }   
    } else if (c1 == WRITE) {       /* #もしWRITE命令ならば */
        if (c3 == A) {              /* #もしレジスタAならば */
            m[c2][1] = DATA;        /* #指定番地に命令コードDATAの値を書き込む。 */
            m[c2][2] = rega;        /* #指定番地にレジスタAの値を書き込む。 */
        } else if (c3 == B) {       /* #もしレジスタBならば */
            m[c2][1] = DATA;        /* #指定番地に命令コードDATAの値を書き込む。 */
            m[c2][2] = regb;        /* #指定番地にレジスタBの値を書き込む。 */
        }
    } else if (c1 == ADD ) {        /* #もしADD命令ならば */
        if (c2 == A) {              /* #もしレジスタAならば */
            rega = rega + m[c3][2]; /* #レジスタAの値に指定番地の値を足したものをレジスタAに代入する。 */
            flagset(rega);          /* #関数flagsetを呼び出す。 */
        } else if (c2 == B) {       /* #もしレジスタBならば */
            regb = regb + m[c3][2]; /* #レジスタBの値に指定番地の値を足したものをレジスタBに代入する。 */
            flagset(regb);          /* #関数flagsetを呼び出す。 */
        }
    } else if (c1 == SUB) {         /* #もしSUB命令ならば */
        if (c2 == A) {              /* #もしレジスタAならば */
            rega = rega - m[c3][2]; /* #レジスタAの値から指定番地の値を引いたものをAレジスタに代入する。 */
            flagset(rega);          /* #関数flagsetを呼び出す。 */
        } else if (c2 == B) {       /* #もしレジスタBならば */
            regb = regb - m[c3][2]; /* #レジスタBの値から指定番地の値を引いたものをBレジスタに代入する。 */
            flagset(regb);          /* #関数flagsetを呼び出す。 */
        }
    }          
/* # JNZ Jump Not Zero 演算結果が0でなければジャンプする。 */
/* # 直前の演算結果が0ならば regfに1がセットされている。 */
    if (c1 == JNZ) {           /* #もしJNZ命令ならば */
        if (regf != 1) {       /* #もしフラグレジスタの値が1でなければ */
            p = c2;          /* #プログラムカウンタに指定番地を代入する。 */
        } else {            /* #そうでなければ */
            p = p + 1;       /* #プログラムカウンタに１を足したものをプログラムカウンタに代入する。 */
        }
    } else {                   /* #そうでなければ */
        p = p + 1;           /* #プログラムカウンタに１を足したものをプログラムカウンタに代入する。 */
            }
    memdump(m);     
}
memdump(m);
/* window.alert("*** PROGRAM END ***") */
}
</script>

<script>
/* #メモリーの内容を表示する関数（メモリダンプ） */
function memdump(x){
    /*
    msg=x;
    window.alert(x);
    window.alert("***メモリダンプ　ここから***"); 
    window.alert("内部コード"+n);
    window.alert("番地　オペコード　オペランド１　オペランド２");
    */
    msg="PC= "+p+" A= "+rega+" B= "+regb+" F= "+regf+"\n";
    for(let i=0; i < x.length; i++ ){
        for(let j=0; j < 4; j++ ){
            msg=msg+x[i][j]+" ";
            }
        msg=msg+"| "
        if ( i%5 == 0 ) {
             msg=msg+"\n" ;    /* キーボードの\（バックシュラッス）￥ではなく　*/
        }
    }
    window.alert(msg);
    /* console.log(msg); */
    /*
    window.alert("***メモリダンプ　ここまで***")
    */
}   

/* #演算結果が0ならばフラグレジスタに1を代入する。それ以外は0を代入する。*/
function flagset(x){
/*    global regf */
    if (x == 0) {
        regf = 1;
    } else {
        regf = 0;
    }
}
/* #レジスタの内容を表示する関数 */
function regdump(){
/*    global p; rega; regb; regf */
window.alert("プログラムカウンタ= "+p+" レジスタA= "+rega+" レジスタB= "+regb+" フラグレジスタ= "+regf)
}
</script>
</body>
</html>
