<!DOCTYPE html>
<html>
<head><title>15C Assembler</title></head>
<body>
<center>
<table id="memTbl" width="40%">
    <tr>
    <td><id="text0_0">番地</td>
    <td><id="text0_1">オペコード</td>
    <td><id="text0_2">オペランド1</td>
    <td><id="text0_3">オペランド2</td>
    <td><id="text0_4"> </td>
    <td><id="text0_5">中央処理装置</td>
    <td><id="text0_6">値</td>
</tr><tr>
    <td><id="text1_0">0</td>
    <td><input type="text" style="border:none" id="text1_1" value="NUL"></td>
    <td><input type="text" style="border:none" id="text1_2" value="NUL"></td>
    <td><input type="text" style="border:none" id="text1_3" value="NUL"></td>
    <td><id="text1_4"> </td>
    <td><id="text1_5">プログラムカウンタ</td>
    <td><id="text1_6"> 1 </td>
</tr><tr>
    <td><id="text2_0">1</td>
    <td><input type="text" style="border:none" id="text2_1" value="READ"></td>
    <td><input type="text" style="border:none" id="text2_2" value="A"></td>
    <td><input type="text" style="border:none" id="text2_3" value="12"></td>
    <td><id="text2_4"> </td>
    <td><id="text2_5">命令レジスタ</td>
    <td><id="text2_6"> </td>
</tr><tr>
    <td><id="text3_0">2</td>
    <td><input type="text" style="border:none" id="text3_1" value="READ"></td>
    <td><input type="text" style="border:none" id="text3_2" value="B"></td>
    <td><input type="text" style="border:none" id="text3_3" value="11"></td>
    <td><id="text3_4"> </td>    
    <td><id="text3_5" >命令読解器</td>
    <td><id="text3_6" > </td>
</tr><tr>
    <td><id="text4_0">3</td>  
    <td><input type="text" style="border:none" id="text4_1" value="ADD"></td>
    <td><input type="text" style="border:none" id="text4_2" value="A"></td>
    <td><input type="text" style="border:none" id="text4_3" value="10"></td>
    <td></id="text4_4"> </td>
    <td></id="text4_5">レジスタA </td>
    <td></id="text4_6"> </td>
</tr><tr>
    <td><id="text5_0">4</td>
    <td><input type="text" style="border:none" id="text5_1" value="SUB"></td>
    <td><input type="text" style="border:none" id="text5_2" value="B"></td>
    <td><input type="text" style="border:none" id="text5_3" value="13"></td>
    <td></id="text5_4"> </td>
    <td></id="text5_5">レジスタB</td>
    <td></id="text5_6"> </td>

</tr><tr>
    <td><id="text6_0">5</td>
    <td><input type="text" style="border:none" id="text6_1" value="JNZ"></td>
    <td><input type="text" style="border:none" id="text6_2" value="3"></td>
    <td><input type="text" style="border:none" id="text6_3" value="NUL"></td>
    <td></id="text6_4"> </td>
    <td></id="text6_5">フラグレジスタ</td>
    <td></id="text6_6"> </td>
</tr><tr>
    <td><id="text7_0">6</td>
    <td><input type="text" style="border:none" id="text7_1" value="WRITE"></td>
    <td><input type="text" style="border:none" id="text7_2" value="12"></td>
    <td><input type="text" style="border:none" id="text7_3" value="A"></td>
    <td></id="text7_4"> </td>
    <td></id="text7_5">演算装置</td>
    <td></id="text7_6"> </td>
</tr><tr>
    <td><id="text8_0">7</td>
    <td><input type="text" style="border:none" id="text8_1" value="STOP"></td>
    <td><input type="text" style="border:none" style="border:none" id="text8_2" value="NUL"></td>
    <td><input type="text" style="border:none" id="text8_3" value="NUL"></td>
    <td></id="text8_4"> </td>
    <td></id="text8_5"> </td>
    <td></id="text7_6"> </td>
</tr><tr>
    <td><id="text9_0">8</td>
    <td><input type="text" style="border:none" id="text9_1" value="NUL"></td>
    <td><input type="text" style="border:none" id="text9_2" value="NUL"></td>
    <td><input type="text" style="border:none" id="text9_3" value="NUL"></td>
    <td></id="text9_4"> </td>
    <td></id="text9_5"> </td>
    <td></id="text9_6"> </td>
</tr><tr>
    <td><id="text10_0">9</td>
    <td><input type="text" style="border:none" id="text10_1" value="NUL"></td>
    <td><input type="text" style="border:none" id="text10_2" value="NUL"></td>
    <td><input type="text" style="border:none" id="text10_3" value="NUL"></td>
    <td></id="text10_4"> </td>
    <td></id="text10_5"> </td>
    <td></id="text10_6"> </td>
</tr><tr>
    <td><id="text11_0">10</td>
    <td><input type="text" style="border:none" id="text11_1" value="DATA"></td>
    <td><input type="text" style="border:none" id="text11_2" value="5"></td>
    <td><input type="text" style="border:none" id="text11_3" value="NUL"></td>
    <td></id="text11_4"> </td>
    <td></id="text11_5"> </td>
    <td></id="text11_6"> </td>
</tr><tr>
    <td><id="text12_0">11</td>
    <td><input type="text" style="border:none" id="text12_1" value="DATA"></td>
    <td><input type="text" style="border:none" id="text12_2" value="2"></td>
    <td><input type="text" style="border:none" id="text12_3" value="NUL"></td>
    <td></id="text12_4"> </td>
    <td></id="text12_5"> </td>
    <td></id="text12_6"> </td>
</tr><tr>
    <td><id="text13_0">12</td>
    <td><input type="text" style="border:none" id="text13_1" value="DATA"></td>
    <td><input type="text" style="border:none" id="text13_2" value="0"></td>
    <td><input type="text" style="border:none" id="text13_3" value="NUL"></td>
    <td></id="text13_4"> </td>
    <td></id="text13_5"> </td>
    <td></id="text13_6"> </td>
</tr><tr>
    <td><id="text14_0">13</td>
    <td><input type="text" style="border:none" id="text14_1" value="NUL"></td>
    <td><input type="text" style="border:none" id="text14_2" value="1"></td>
    <td><input type="text" style="border:none" id="text14_3" value="NUL"></td>
    <td></id="text14_4"> </td>
    <td></id="text14_5"> </td>
    <td></id="text14_6"> </td>
</tr><tr>
    <td><id="text15_0">14</td>
    <td><input type="text" style="border:none" id="text15_1" value=""></td>
    <td><input type="text" style="border:none" id="text15_2" value=""></td>
    <td><input type="text" style="border:none" id="text15_3" value=""></td>
    <td></id="text15_4"> </td>
    <td></id="text15_5"> </td>
    <td></id="text15_6"> </td>
</tr><tr>
    <td><id="text16_0">15</td>
    <td><input type="text" style="border:none" id="text16_1" value=""></td>
    <td><input type="text" style="border:none" id="text16_2" value=""></td>
    <td><input type="text" style="border:none" id="text16_3" value=""></td>
</tr><tr>
    <td><id="text17_0">16</td>
    <td><input type="text" style="border:none" id="text17_1" value=""></td>
    <td><input type="text" style="border:none" id="text17_2" value=""></td>
    <td><input type="text" style="border:none" id="text17_3" value=""></td>
</tr><tr>
    <td><id="text18_0">17</td>
    <td><input type="text" style="border:none" id="text18_1" value=""></td>
    <td><input type="text" style="border:none" id="text18_2" value=""></td>
    <td><input type="text" style="border:none" id="text18_3" value=""></td>
</tr><tr>
    <td><id="text19_0">18</td>
    <td><input type="text" style="border:none" id="text19_1" value=""></td>
    <td><input type="text" style="border:none" id="text19_2" value=""></td>
    <td><input type="text" style="border:none" id="text19_3" value=""></td>
</tr><tr>
    <td><id="text20_0">19</td>
    <td><input type="text" style="border:none" id="text20_1" value=""></td>
    <td><input type="text" style="border:none" id="text20_2" value=""></td>
    <td><input type="text" style="border:none" id="text20_3" value=""></td>
</tr><tr>
    <td><id="text21_0">20</td>
    <td><input type="text" style="border:none" id="text21_1" value=""></td>
    <td><input type="text" style="border:none" id="text21_2" value=""></td>
    <td><input type="text" style="border:none" id="text21_3" value=""></td>
</tr><tr>
    <td><id="text22_0">21</td>
    <td><input type="text" style="border:none" id="text22_1" value=""></td>
    <td><input type="text" style="border:none" id="text22_2" value=""></td>
    <td><input type="text" style="border:none" id="text22_3" value=""></td>
</tr><tr>
    <td><id="text23_0">22</td>
    <td><input type="text" style="border:none" id="text23_1" value=""></td>
    <td><input type="text" style="border:none" id="text23_2" value=""></td>
    <td><input type="text" style="border:none" id="text23_3" value=""></td>
</tr><tr>
    <td><id="text24_0">23</td>
    <td><input type="text" style="border:none" id="text24_1" value=""></td>
    <td><input type="text" style="border:none" id="text24_2" value=""></td>
    <td><input type="text" style="border:none" id="text24_3" value=""></td>
</tr><tr>
    <td><id="text25_0">24</td>
    <td><input type="text" style="border:none" id="text25_1" value=""></td>
    <td><input type="text" style="border:none" id="text25_2" value=""></td>
    <td><input type="text" style="border:none" id="text25_3" value=""></td>
</tr><tr>
    <td><id="text26_0">25</td>
    <td><input type="text" style="border:none" id="text26_1" value=""></td>
    <td><input type="text" style="border:none" id="text26_2" value=""></td>
    <td><input type="text" style="border:none" id="text26_3" value=""></td>
</tr><tr>
    <td><id="text27_0">26</td>
    <td><input type="text" style="border:none" id="text27_1" value=""></td>
    <td><input type="text" style="border:none" id="text27_2" value=""></td>
    <td><input type="text" style="border:none" id="text27_3" value=""></td>
</tr><tr>
    <td><id="text28_0">27</td>
    <td><input type="text" style="border:none" id="text28_1" value=""></td>
    <td><input type="text" style="border:none" id="text28_2" value=""></td>
    <td><input type="text" style="border:none" id="text28_3" value=""></td>
</tr><tr>
    <td><id="text29_0">28</td>
    <td><input type="text" style="border:none" id="text29_1" value=""></td>
    <td><input type="text" style="border:none" id="text29_2" value=""></td>
    <td><input type="text" style="border:none" id="text29_3" value=""></td>
</tr><tr>
    <td><id="text30_0">29</td>
    <td><input type="text" style="border:none" id="text30_1" value=""></td>
    <td><input type="text" style="border:none" id="text30_2" value=""></td>
    <td><input type="text" style="border:none" id="text30_3" value=""></td>
</tr>
</table>
</center>
<script>
/* memTbl.style.textAlign = "center"; */
/* memTbl.style.verticalAlign = "middle"; */
window.onload = function(){
/* # Python15B (学習ノートP37も可) */
/* # 疑似言語の命令コードを定義する。*/
READ=1; WRITE=2; ADD=3; STOP=4; SUB=5; JNZ=8; DATA=9;
A=6; B=7;                 /* # Aレジスタ、Bレジスタ */
NUL = null;               /* # nullは予約語 空欄 何もしない 何もない ヌル */
n=["0=未定義","1=READ","2=WRITE","3=ADD","4=STOP","5=SUB","6=A","7=B","8=JNZ","9=DATA"];
/* # 主記憶(メモリ)この下にプログラムやデータを記入する。 */
m=[];
/* # [c0, c1, c2, c3] # */
m.push([0, NUL, NUL, NUL]);
m.push([1, READ, A, 12]);
m.push([2, READ, B, 11]);
m.push([3, ADD, A, 10]);
m.push([4, SUB, B, 13]);
m.push([5, JNZ, 3, NUL]);
m.push([6, WRITE, 12, A]);
m.push([7, STOP, NUL, NUL]);
m.push([8, NUL, NUL, NUL]);
m.push([9, NUL, NUL, NUL]);
m.push([10,DATA, 5, NUL]);      /* # 5×2=10 */
m.push([11,DATA, 2, NUL]);
m.push([12,DATA, 0, NUL]);      /* #計算結果が入る */
m.push([13,DATA, 1, NUL]);      /* #定数1 2-1=1,1-1=0 */
m.push([14,NUL, NUL, NUL]);
window.alert("*** PROGRAM START ***")
p=0;            /* #プログラムカウンタに0を代入する。*/
rega=0;regb=0;  /* #レジスタAに0，レジスタBに0を代入する。 */
regf=0;         /* #フラグレジスタに0を代入する。 演算結果が0のときに１，それ以外は0 */
/* regdump()      /* #プログラムカウンタの値とレジスタの値を表示する。 */
memdump(m);
}
</script>

<script>
function main(){
while (m[p][1] != STOP) {      /* #STOPでない間以下を繰り返す。 */
/* #c0=行番号,c1=命令,c2=レジスタ名または番地,c3=レジスタ名または番地 */
    c0=m[p][0]; c1=m[p][1]; c2=m[p][2]; c3=m[p][3]
    if (c1 == NUL) {           /* #もしNUL命令ならば */
        ;                      /* #なにもしない。 */
        }
/* 実行命令 */               
    if (c1 == READ) {               /* #もしREAD命令ならば */
        if (c2 == A) {              /* #もしレジスタAならば */
            rega = m[c3][2];        /* #指定番地の値をレジスタAに読み込む。 */
        } else if (c2 == B) {       /* #もしレジスタBならば */
            regb = m[c3][2];        /* #指定番地の値をレジスタBに読み込む。 */
        }   
    } else if (c1 == WRITE) {       /* #もしWRITE命令ならば */
        if (c3 == A) {              /* #もしレジスタAならば */
            m[c2][1] = DATA;        /* #指定番地に命令コードDATAの値を書き込む。 */
            m[c2][2] = rega;        /* #指定番地にレジスタAの値を書き込む。 */
        } else if (c3 == B) {       /* #もしレジスタBならば */
            m[c2][1] = DATA;        /* #指定番地に命令コードDATAの値を書き込む。 */
            m[c2][2] = regb;        /* #指定番地にレジスタBの値を書き込む。 */
        }
    } else if (c1 == ADD ) {        /* #もしADD命令ならば */
        if (c2 == A) {              /* #もしレジスタAならば */
            rega = rega + m[c3][2]; /* #レジスタAの値に指定番地の値を足したものをレジスタAに代入する。 */
            flagset(rega);          /* #関数flagsetを呼び出す。 */
        } else if (c2 == B) {       /* #もしレジスタBならば */
            regb = regb + m[c3][2]; /* #レジスタBの値に指定番地の値を足したものをレジスタBに代入する。 */
            flagset(regb);          /* #関数flagsetを呼び出す。 */
        }
    } else if (c1 == SUB) {         /* #もしSUB命令ならば */
        if (c2 == A) {              /* #もしレジスタAならば */
            rega = rega - m[c3][2]; /* #レジスタAの値から指定番地の値を引いたものをAレジスタに代入する。 */
            flagset(rega);          /* #関数flagsetを呼び出す。 */
        } else if (c2 == B) {       /* #もしレジスタBならば */
            regb = regb - m[c3][2]; /* #レジスタBの値から指定番地の値を引いたものをBレジスタに代入する。 */
            flagset(regb);          /* #関数flagsetを呼び出す。 */
        }
    }          
/* # JNZ Jump Not Zero 演算結果が0でなければジャンプする。 */
/* # 直前の演算結果が0ならば regfに1がセットされている。 */
    if (c1 == JNZ) {           /* #もしJNZ命令ならば */
        if (regf != 1) {       /* #もしフラグレジスタの値が1でなければ */
            p = c2;          /* #プログラムカウンタに指定番地を代入する。 */
        } else {            /* #そうでなければ */
            p = p + 1;       /* #プログラムカウンタに１を足したものをプログラムカウンタに代入する。 */
        }
    } else {                   /* #そうでなければ */
        p = p + 1;           /* #プログラムカウンタに１を足したものをプログラムカウンタに代入する。 */
            }
    memdump(m);     
}
memdump(m);
/* window.alert("*** PROGRAM END ***") */
}
</script>

<script>
/* #メモリーの内容を表示する関数（メモリダンプ） */
function memdump(x){
    /*
    msg=x;
    window.alert(x);
    window.alert("***メモリダンプ　ここから***"); 
    window.alert("内部コード"+n);
    window.alert("番地　オペコード　オペランド１　オペランド２");
    */
    msg="PC= "+p+" A= "+rega+" B= "+regb+" F= "+regf+"\n";
    for(let i=0; i < x.length; i++ ){
        for(let j=0; j < 4; j++ ){
            msg=msg+x[i][j]+" ";
            }
        msg=msg+"| "
        if ( i%5 == 0 ) {
             msg=msg+"\n" ;    /* キーボードの\（バックシュラッス）￥ではなく　*/
        }
    }
    window.alert(msg);
    /* console.log(msg); */
    /*
    window.alert("***メモリダンプ　ここまで***")
    */
}   

/* #演算結果が0ならばフラグレジスタに1を代入する。それ以外は0を代入する。*/
function flagset(x){
/*    global regf */
    if (x == 0) {
        regf = 1;
    } else {
        regf = 0;
    }
}
/* #レジスタの内容を表示する関数 */
function regdump(){
/*    global p; rega; regb; regf */
window.alert("プログラムカウンタ= "+p+" レジスタA= "+rega+" レジスタB= "+regb+" フラグレジスタ= "+regf)
}
</script>
</body>
</html>
